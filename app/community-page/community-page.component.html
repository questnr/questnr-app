<Page xmlns="http://www.nativescript.org/tns.xsd" class="home-wrapper">
  <Page.actionBar>
    <qn-action-bar [pageViewContainerRef]="viewContainerRef"></qn-action-bar>
  </Page.actionBar>
  <GridLayout>
    <PullToRefresh (refresh)="refreshList($event)" [indicatorFillColor]="qColors.$primary"
      [indicatorColor]="qColors.$white">
      <ScrollView (scroll)="onScroll($event)" (loaded)="onScrollViewLoaded($event)"
        [isUserInteractionEnabled]="userInteractionService.isUserInteractionEnabled$ | async">
        <StackLayout class="community-page-wrapper">
          <GridLayout class="community-avatar" rows="*" columns="*">
            <StackLayout row="0">
              <NSImg [placeholderImageUri]="defaultSrc" [failureImageUri]="defaultSrc" verticalAlignment="center"
                [src]="modifiedCommunityAvatarPath ? modifiedCommunityAvatarPath : community?.avatarDTO?.avatarLink ? community?.avatarDTO?.avatarLink : defaultSrc"
                loadMode="async" stretch="aspectFill" (failure)="onFailure($event)">
              </NSImg>
            </StackLayout>
            <StackLayout class="community-details" row="0" verticalAlignment="bottom">
              <StackLayout (loaded)="onCommuityDetailsViewLoaded($event)" (tap)="onShowCommunityCard($event)" ripple
                [rippleColor]="qColors.$whiteTransparent">
                <Label class="community-name" [text]="community?.communityName"></Label>
              </StackLayout>
            </StackLayout>
            <StackLayout class="modify" row="0" verticalAlignment="top" horizontalAlignment="right">
              <Button class="fa" text="&#xf040;" (tap)="onCommunityAvatarEdit()" ripple
                [rippleColor]="qColors.$heading"></Button>
            </StackLayout>
          </GridLayout>

          <StackLayout class="community-body">
            <GridLayout class="community-members">
              <qn-community-members #communityMemeberComp></qn-community-members>
            </GridLayout>
            <GridLayout class="community-settings">
              <FlexboxLayout justifyContent="space-between">
                <GridLayout alignSelf="flex-start">
                  <StackLayout orientation="horizontal" horizontalAlignment="left">
                    <qn-community-relation-action-button
                      *ngIf="relationType && relationType !== relationTypeClass.OWNED"
                      (actionEvent)="onRelationChangeEvent($event)" [qHeight]="45" #relationButtonComp>
                    </qn-community-relation-action-button>
                  </StackLayout>
                </GridLayout>
                <GridLayout alignSelf="flex-end">
                  <Button class="fa settings-button" height="50" text="&#xf013;" (tap)="onOpenCommunitySettings($event)"
                    horizontalAlignment="right"></Button>
                </GridLayout>
              </FlexboxLayout>
            </GridLayout>
            <GridLayout class="owner-profile">
              <qn-horizontal-owner-profile [user]="community?.ownerUserDTO" #ownerProfileComp>
              </qn-horizontal-owner-profile>
            </GridLayout>
            <GridLayout class="community-activity">
              <qn-community-activity [actAlone]="false" (onScrollToPostEvent)="onScrollToPostEvent($event)"
                #communityActivityComp></qn-community-activity>
            </GridLayout>
            <GridLayout class="community-questions">
              <qn-question-list-card [type]="questionListTypeClass.community" #questionListCardComp>
              </qn-question-list-card>
            </GridLayout>
            <GridLayout class="create-post">
              <qn-create-post [isCommunityPost]="true" [communityId]="community?.communityId"
                (onPostCreated)="handlePostCreation($event)" (onPostEdited)="handlePostEditing($event)">
              </qn-create-post>
            </GridLayout>
            <StackLayout id="community-post-feed" #container>
              <StackLayout *ngFor="let feed of communityFeeds;" class="user-feed">
                <StackLayout *ngIf="feed.postType == postTypeClass.simple">
                  <qn-simple-post [feed]="feed">
                  </qn-simple-post>
                </StackLayout>
                <StackLayout *ngIf="feed.postType == postTypeClass.question">
                  <qn-simple-question [feed]="feed" [questionParentType]="questionParentTypeClass.feedPage">
                  </qn-simple-question>
                </StackLayout>
              </StackLayout>
              <StackLayout *ngIf="isLoading">
                <qn-post-skeleton></qn-post-skeleton>
              </StackLayout>
            </StackLayout>
          </StackLayout>
        </StackLayout>
      </ScrollView>
    </PullToRefresh>
  </GridLayout>
</Page>