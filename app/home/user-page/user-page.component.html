<Page xmlns="http://www.nativescript.org/tns.xsd" class="home-wrapper">
    <Page.actionBar>
        <qn-action-bar [pageViewContainerRef]="viewContainerRef"></qn-action-bar>
    </Page.actionBar>
    <GridLayout>
        <PullToRefresh (refresh)="refreshList($event)" [indicatorFillColor]="qColors.$primary"
            [indicatorColor]="qColors.$white">
            <ScrollView (scroll)="onScroll($event)" (loaded)="onScrollViewLoaded($event)"
                [isUserInteractionEnabled]="userInteractionService.isUserInteractionEnabled$ | async">
                <StackLayout class="user-page-wrapper">
                    <GridLayout class="user-banner-wrapper" rows="*" columns="*">
                        <StackLayout row="0" class="user-banner">
                            <NSImg [placeholderImageUri]="defaultBanner" [failureImageUri]="defaultBanner"
                                [src]="modifiedUserBannerPath ? modifiedUserBannerPath : user?.banner?.avatarLink ? user?.banner?.avatarLink : defaultBanner"
                                loadMode="async" stretch="aspectFill" (failure)="onUserBannerFailure($event)"
                                (tap)="onUserBannerTap($event)">
                            </NSImg>
                        </StackLayout>
                        <StackLayout row="0" class="user-avatar" verticalAlignment="middle" height="100" width="100"
                            (loaded)="onUserAvatarViewLoaded($event)">
                            <NSImg roundAsCircle="true" [placeholderImageUri]="defaultSrc"
                                [failureImageUri]="defaultSrc" verticalAlignment="middle" horizontalAlignment="center"
                                [src]="modifiedUserAvatarPath ? modifiedUserAvatarPath : user?.avatarDTO?.avatarLink ? user?.avatarDTO?.avatarLink : defaultSrc"
                                loadMode="async" stretch="aspectFill" (failure)="onUserAvatarFailure($event)">
                            </NSImg>
                        </StackLayout>
                    </GridLayout>
                    <GridLayout class="user-details" ripple [rippleColor]="qColors.$whiteTransparent" rows="*">
                        <Label class="username" row="0" [text]="user?.username"></Label>
                        <StackLayout class="modify" row="0" verticalAlignment="top" horizontalAlignment="right">
                            <Button class="fa" text="&#xf040;" (tap)="onUserDetailsEdit($event)" ripple
                                [rippleColor]="qColors.$heading"></Button>
                        </StackLayout>
                    </GridLayout>
                    <StackLayout class="user-body">
                        <GridLayout class="user-description">
                            <qn-user-description-card [bio]="user?.bio"></qn-user-description-card>
                        </GridLayout>
                        <GridLayout class="create-post">
                            <qn-create-post [isCommunityPost]="false" (onPostCreated)="handlePostCreation($event)"
                                (onPostEdited)="handlePostEditing($event)">
                            </qn-create-post>
                        </GridLayout>
                        <StackLayout id="user-post-feed" #container>
                            <StackLayout *ngFor="let feed of userFeeds;" class="user-feed">
                                <StackLayout *ngIf="feed.postType == postTypeClass.simple">
                                    <qn-simple-post [feed]="feed">
                                    </qn-simple-post>
                                </StackLayout>
                                <StackLayout *ngIf="feed.postType == postTypeClass.question">
                                    <qn-simple-question [feed]="feed"
                                        [questionParentType]="questionParentTypeClass.feedPage">
                                    </qn-simple-question>
                                </StackLayout>
                            </StackLayout>
                            <StackLayout *ngIf="isLoading">
                                <qn-post-skeleton></qn-post-skeleton>
                            </StackLayout>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </ScrollView>
        </PullToRefresh>
    </GridLayout>
</Page>